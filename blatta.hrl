-record(board, {p, b, n, r, q, k, s}).
-record(engine, {process}).
-record(game, {w, b, main_board, turn}).

-define(UCIOK, io:format("uciok~n",[])).
-define(WBOARD, 16#ffff).
-define(BBOARD, 16#ffff000000000000).
-define(DRAW_LINE, io:format("+--+--+--+--+--+--+--+--+~n", [])).
-define(EMPTY_GAME, #game{w=0, b=0, turn=2, main_board=#board{p=0, b=0, n=0, r=0, q=0, k=0, s=array:new([{size,64},{fixed,true},{default,0}])}}).
-define(START_POS, "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR").
-define(POWS, {1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,
 262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,
 134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,
 17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,
 1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,
 35184372088832,70368744177664,140737488355328,281474976710656,
 562949953421312,1125899906842624,2251799813685248,4503599627370496,
 9007199254740992,18014398509481984,36028797018963968,72057594037927936,
 144115188075855872,288230376151711744,576460752303423488,1152921504606846976,
 2305843009213693952,4611686018427387904,9223372036854775808,
 18446744073709551616}.

-define(STRING_POS, {
		"a1", "b1", "c1", "d1", "e1", "f1", "g1", "h1",
		"a2", "b2", "c2", "d2", "e2", "f2", "g2", "h2",
		"a3", "b3", "c3", "d3", "e3", "f3", "g3", "h3",
		"a4", "b4", "c4", "d4", "e4", "f4", "g4", "h4",
		"a5", "b5", "c5", "d5", "e5", "f5", "g5", "h5",
		"a6", "b6", "c6", "d6", "e6", "f6", "g6", "h6",
		"a7", "b7", "c7", "d7", "e7", "f7", "g7", "h7",
		"a8", "b8", "c8", "d8", "e8", "f8", "g8", "h8"});

-define(WHITE_PAWN_ATTACK, {
		16#0000000000000300,16#0000000000000700,16#0000000000000e00,16#0000000000001c00,16#0000000000003800,16#0000000000007000,16#000000000000e000,16#000000000000c000,
		16#0000000001030000,16#0000000002070000,16#00000000040e0000,16#00000000081c0000,16#0000000010380000,16#0000000020700000,16#0000000040e00000,16#0000000080c00000,
		16#0000000003000000,16#0000000007000000,16#000000000e000000,16#000000001c000000,16#0000000038000000,16#0000000070000000,16#00000000e0000000,16#00000000c0000000,
		16#0000000300000000,16#0000000700000000,16#0000000e00000000,16#0000001c00000000,16#0000003800000000,16#0000007000000000,16#000000e000000000,16#000000c000000000,
		16#0000030000000000,16#0000070000000000,16#00000e0000000000,16#00001c0000000000,16#0000380000000000,16#0000700000000000,16#0000e00000000000,16#0000c00000000000,
		16#0003000000000000,16#0007000000000000,16#000e000000000000,16#001c000000000000,16#0038000000000000,16#0070000000000000,16#00e0000000000000,16#00c0000000000000,
		16#0300000000000000,16#0700000000000000,16#0e00000000000000,16#1c00000000000000,16#3800000000000000,16#7000000000000000,16#e000000000000000,16#c000000000000000,
		16#0000000000000000,16#0000000000000000,16#0000000000000000,16#0000000000000000,16#0000000000000000,16#0000000000000000,16#0000000000000000,16#0000000000000000}).

-define(BLACK_PAWN_ATTACK, {
		16#0000000000000000,16#0000000000000000,16#0000000000000000,16#0000000000000000,16#0000000000000000,16#0000000000000000,16#0000000000000000,16#0000000000000000,
		16#0000000000000003,16#0000000000000007,16#000000000000000e,16#000000000000001c,16#0000000000000038,16#0000000000000070,16#00000000000000e0,16#00000000000000c0,
		16#0000000000000300,16#0000000000000700,16#0000000000000e00,16#0000000000001c00,16#0000000000003800,16#0000000000007000,16#000000000000e000,16#000000000000c000,
		16#0000000000030000,16#0000000000070000,16#00000000000e0000,16#00000000001c0000,16#0000000000380000,16#0000000000700000,16#0000000000e00000,16#0000000000c00000,
		16#0000000003000000,16#0000000007000000,16#000000000e000000,16#000000001c000000,16#0000000038000000,16#0000000070000000,16#00000000e0000000,16#00000000c0000000,
		16#0000000300000000,16#0000000700000000,16#0000000e00000000,16#0000001c00000000,16#0000003800000000,16#0000007000000000,16#000000e000000000,16#000000c000000000,
		16#0000030100000000,16#0000070200000000,16#00000e0400000000,16#00001c0800000000,16#0000381000000000,16#0000702000000000,16#0000e04000000000,16#0000c08000000000,
		16#0003000000000000,16#0007000000000000,16#000e000000000000,16#001c000000000000,16#0038000000000000,16#0070000000000000,16#00e0000000000000,16#00c0000000000000}).

-define(DB64, {
   63,  0, 58,  1, 59, 47, 53,  2,
   60, 39, 48, 27, 54, 33, 42,  3,
   61, 51, 37, 40, 49, 18, 28, 20,
   55, 30, 34, 11, 43, 14, 22,  4,
   62, 57, 46, 52, 38, 26, 32, 41,
   50, 36, 17, 19, 29, 10, 13, 21,
   56, 45, 25, 31, 35, 16,  9, 12,
   44, 24, 15,  8, 23,  7,  6,  5
}).
-define(KDB64, 16#07EDD5E59A4E28C2).
-define(KBMASK, 16#0FFFFFFFFFFFFFFFF).
lbpow(I) -> element(I+1, ?POWS).

bsf(BB) ->
        element((((((BB band (-BB)) band ?KBMASK) * ?KDB64) band ?KBMASK) bsr 58) + 1, ?DB64).

get_info($p) -> {#game.w, #board.p};
get_info($r) -> {#game.w, #board.r};
get_info($n) -> {#game.w, #board.n};
get_info($b) -> {#game.w, #board.b};
get_info($q) -> {#game.w, #board.q};
get_info($k) -> {#game.w, #board.k};
get_info($P) -> {#game.b, #board.p};
get_info($R) -> {#game.b, #board.r};
get_info($N) -> {#game.b, #board.n};
get_info($B) -> {#game.b, #board.b};
get_info($Q) -> {#game.b, #board.q};
get_info($K) -> {#game.b, #board.k}.

%%%get_pawn_table_attack(#game.w, I) -> element(I+1, ?WHITE_PAWN_ATTACK);
%%%get_pawn_table_attack(#game.b, I) -> element(I+1, ?BLACK_PAWN_ATTACK); 
